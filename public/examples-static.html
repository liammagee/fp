<html>
    <head>
        <title>Fierce Planet</title>
        <link rel="stylesheet" type="text/css" href="css/fp.css">
        <script src="js/require.js"></script>
        <script>
        requirejs.config({
            baseUrl: 'js',
            "shim": {
                "underscore": { exports: "_" },
                "dat.gui": { exports: "dat.gui" },
                "smoothie": { exports: "SmoothieChart" },
                "stats.min": { exports: "Stats" },
                "jstat.min": { exports: "jStat" },
                "three": { exports: "THREE" },
                "Mirror": ["three"],
                "WaterShader": ["three"],
                "TerrainLoader": { deps: ["three"], exports: "TerrainLoader" },
                "js/controls/TrackballControls.js": {  deps: ["three"], exports: "TrackballControls" },
                "js/controls/PointerLockControls.js": {  deps: ["three"], exports: "PointerLockControls" },
            }
        })
        requirejs([
                "fp",
                "dat.gui",
                "smoothie",
                "stats.min",
                "jstat.min",
                "Mirror",
                "WaterShader",
                "TerrainLoader",
                "js/THREEx.KeyboardState.js",
                "js/controls/TrackballControls.js",
                "js/controls/PointerLockControls.js",
            ],
            function() {
                var roadColor = fp.buildColorInteger(255, 255, 255);
                var config = {
                  "preset": "Default",
                  "remembered": {
                    "Default": {
                        "1": {
                            "initialPopulation": 0
                        },
                        "2": {},
                        "3": {
                            "overlapThreshold": 100,
                            "roadRadiusSegments": 8
                        },
                        "4": {
                            "statsShow": false,
                            "chartShow": false,
                            "topDownView": true,
                        },
                        "5": {
                            "colorNightRoad": roadColor //16777215
                        },
                        "6": {
                            "multiplier": 1,
                            "loadHeights": false
                        }
                    }
                  }
                }
                var sim =  {
                    counter: 0,
                    setup: function() {
                        // Create a grid road structure
                        for (var i = 0; i < 11; i++) {
                            var x = i * 200 - 1000,
                                z1 = -1000,
                                z2 = 1000,
                                y1 = fp.getHeight(x, z1),
                                y2 = fp.getHeight(x, z2),
                                p1 = new THREE.Vector3(x, y1, z1),
                                p2 = new THREE.Vector3(x, y2, z2);
                            fp.roadNetwork.addRoad(p1, p2, 10);
                        }
                        for (var i = 0; i < 11; i++) {
                            var z = i * 200 - 1000,
                                x1 = -1000,
                                x2 = 1000,
                                y1 = fp.getHeight(x1, z),
                                y2 = fp.getHeight(x2, z),
                                p1 = new THREE.Vector3(x1, y1, z),
                                p2 = new THREE.Vector3(x2, y2, z);
                            fp.roadNetwork.addRoad(p1, p2, 10);
                        }


                        // Create 100 buildings
                        var counter = 0, minHeight = 30, maxHeight = 100;
                        while (counter < 100) {
                            var x = Math.floor(Math.random() * 4000) - 2000,
                                z = Math.floor(Math.random() * 4000) - 2000,
                                y = fp.getHeight(x, z)
                            var position = new THREE.Vector3(x, y, z);
                            var dimensions = fp.buildingNetwork.generateRandomDimensions();
                            var building = fp.buildingNetwork.createBuilding(position, dimensions);
                            if ( typeof( building ) !== "undefined" ) {
                                var height = Math.floor( Math.random() * (maxHeight - minHeight) ) + minHeight;
                                for (var i = 0; i < height; i++)
                                    if (building.canAddFloor() )
                                        building.addFloor();
                                counter++;
                            }
                        }
                        console.log( counter )
                    },
                    tick: function() {
                        //console.log("Custom tick: " + (++ counter))
                    }
                }

                fp.init( config, sim, function() {
                    fp.appConfig().Setup();
                } );
            }
        );

        </script>
    </head>
    <body>
        <div id="container"></div>
    </body>
</html>
